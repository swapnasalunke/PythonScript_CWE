import pandas as pd
import csv

csvFile = pd.read_csv("expectedIssues.csv")
counter = 0

# User defined exception for empty file
class EmptyFileError(Exception):
    pass

track = []
# Setting header for expFile
h = ['Exception','File']
with open('exception.csv','w',newline='') as head:
    header = csv.writer(head)
    header.writerow(h)


for col in range(len(csvFile)):
    path = csvFile['File'][col]

    try:
        with open(path, 'r') as file:
            content = file.readlines()
            if not content:
                raise EmptyFileError()
        content.insert((int((csvFile['Line'][col])) - 8), "// Start: Expecting " + csvFile['CWE'][col] + "\n")
        content.insert(((int(csvFile['Line'][col])) + 8), "// End: " + csvFile['CWE'][col] + "\n")

        with open(path, "w") as file:
            content = "".join(content)
            file.write(content)

    except (FileNotFoundError, PermissionError, EOFError) as e :
        counter +=1
        track.append(((type(e).__name__),(csvFile['File'][col])))
    except EmptyFileError as e:
        counter += 1
        track.append(((type(e).__name__),(csvFile['File'][col])))
    except Exception as e:
        counter += 1
        track.append(((type(e).__name__),(csvFile['File'][col])))

print("Number of Files Having Exceptions: ",counter)
with open('exception.csv', 'a', newline='') as cf:
    data = csv.writer(cf)
    data.writerows(track)
f = pd.read_csv('exception.csv')
print("Number of record stored in expFile:",len(f))
